<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <script src="https://cdn.rawgit.com/caldwell/renderjson/master/renderjson.js"></script>
    <script>
        window.onload = function () {
            document.getElementById("loading").style.display = "none";

            let httpverbs = document.querySelectorAll('input[name="HttpVerb"]');
            for (let i = 0; i < httpverbs.length; i++) {

                httpverbs[i].addEventListener("change", function () {
                    if (this.value == "POST" || this.value == "PUT")
                        ShowHideRequestBody(true);
                    else
                        ShowHideRequestBody(false);
                });
            }
            httpverbs[0].checked = true;

        }
        let xhttp = new XMLHttpRequest();

        function ShowHideRequestBody(show) {
            if (show === true) {
                document.getElementById("Div_RequestBody").style.display = "block";
            }
            else {
                document.getElementById("Div_RequestBody").style.display = "none";
            }
        }

        function CancelRequest() {
            xhttp.abort();
        }
        function TestAPI() {
            let APIURL = document.getElementById("APIURL").value.trim();

            if (APIURL != "") {
                document.getElementById("loading").style.display = "block";

                let httpverb = document.querySelector('input[name="HttpVerb"]:checked').value;

                xhttp.onreadystatechange = function () {
                    console.log(this);
                    if (this.readyState == 4) {
                        document.getElementById("loading").style.display = "none";
                        document.getElementById("container").innerHTML = "";
                        document.getElementById("container").appendChild(renderjson(JSON.parse(this.response)));
                    }
                }

                let Params_Tr = document.getElementsByClassName("trParams");

                for (let i = 0; i < Params_Tr.length; i++) {
                    let ParamKey = Params_Tr[i].children[1].children[0].value.trim();
                    let ParamVal = Params_Tr[i].children[2].children[0].value.trim();
                    console.log(ParamKey);
                    console.log(ParamVal);
                    if (ParamKey != "" && ParamVal != "") {
                        APIURL = addParams(APIURL, ParamKey, ParamVal);
                    }
                }

                APIURL = addParams(APIURL, "_", Date.now());

                xhttp.open(httpverb, APIURL, true);

                let header_Tr = document.getElementsByClassName("trHeader");

                for (let i = 0; i < header_Tr.length; i++) {
                    let HeaderKey = header_Tr[i].children[1].children[0].value.trim();
                    let HeaderVal = header_Tr[i].children[2].children[0].value.trim();
                    console.log(HeaderKey);
                    console.log(HeaderVal);
                    if (HeaderKey != "" && HeaderVal != "")
                        xhttp.setRequestHeader(HeaderKey, HeaderVal);
                }

                let RequestBody = null;
                if (httpverb == "POST" || httpverb == "PUT")
                    RequestBody = document.getElementById("RequestBody").value.trim();



                xhttp.send(RequestBody);

            }
            else {
                alert('Please enter a URL');
            }
        }

        function addParams(url, key, value) {
            if (url.trim() != "") {
                if (url.indexOf("?") === -1) {
                    url = url + "?" + key + "=" + value;
                }
                else {
                    url = url + "&" + key + "=" + value;
                }
            }
            return url;
        }

        function AddRow(tableId) {
            let table = document.getElementById(tableId);
            let row = table.insertRow(-1);
            let cell1 = row.insertCell(0);
            let cell2 = row.insertCell(1);
            let cell3 = row.insertCell(2);
            cell1.innerHTML = " <button onclick='DeleteRow(this);'>-</button>";
            if (tableId == 'tblHeaders') {
                cell2.innerHTML = "<input type='text' placeholder='Key header' size='50' />";
                cell3.innerHTML = "<input type='text' placeholder='Val header' size='50' />";
                row.setAttribute("class", "trHeader");
            } else {
                cell2.innerHTML = "<input type='text' placeholder='Key param' size='50' />";
                cell3.innerHTML = "<input type='text' placeholder='Val param' size='50' />";
                row.setAttribute("class", "trParams");
            }
        }

        function DeleteRow(buttonDelete) {
            buttonDelete.parentNode.parentNode.parentNode.removeChild(buttonDelete.parentNode.parentNode);
        }
    </script>
    <style>
        #loading {
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
            position: fixed;
            display: block;
            z-index: 99;
            background-color: black;
            opacity: 0.6;
        }

        #loading-text {
            color: white;
            position: absolute;
            top: 40%;
            left: 45%;
            z-index: 100;
        }
    </style>
</head>

<body>
    <div id="loading">
        <div id="loading-text">Please Wait
            <button onclick="CancelRequest()">Cancel Request</button>
        </div>
    </div>
    <label for="APIURL">URL:</label>
    <input type="text" id="APIURL" placeholder="URL" size="100"
        value="http://localhost/WSL.SS.REST/Api/Users/ActiveUserInfo" />
    <hr />
    <input type="radio" id="rd_GET" name="HttpVerb" value="GET" />
    <label for="rd_GET">GET</label>
    <input type="radio" id="rd_POST" name="HttpVerb" value="POST" />
    <label for="rd_POST">POST</label>
    <input type="radio" id="rd_PUT" name="HttpVerb" value="PUT" />
    <label for="rd_PUT">PUT</label>
    <input type="radio" id="rd_DELETE" name="HttpVerb" value="DELETE" />
    <label for="rd_DELETE">DELETE</label>

    <hr />

    <button onclick="AddRow('tblHeaders');">Add Headers</button>
    <table id="tblHeaders"></table>

    <hr />

    <button onclick="AddRow('tblParams');">Add Params</button>
    <table id="tblParams"></table>

    <div id="Div_RequestBody" style="display: none;">
        <hr />
        <label>Request Body:</label>
        <br />
        <textarea id="RequestBody" style="width: 250px;height: 250px;"></textarea>
    </div>

    <hr />

    <button onclick="TestAPI();">test API</button>

    <hr />

    <div id="container"></div>
</body>

</html>